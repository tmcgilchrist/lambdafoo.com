<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>My Hakyll Blog - Simple TCP Server in Erlang</title>
        <link rel="stylesheet" type="text/css" href="../css/default.css" />
        <link rel="stylesheet" type="text/css" href="../css/screen.css" />
    </head>
    <body>
        <div id="header">
            <div id="logo">
                <a href="../">My Hakyll Blog</a>
            </div>
            <div id="navigation">
                <a href="../">Home</a>
                <a href="../about.html">About</a>
                <a href="../talks.html">Talks</a>
                <a href="../archive.html">Archive</a>
            </div>
        </div>

        <div id="content">
            <h1>Simple TCP Server in Erlang</h1>

            <div class="info">
    Posted on October 12, 2008
    
        by Tim McGilchrist
    
</div>

<p>Just a quick example of a tcp server that returns the current time.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode erlang"><code class="sourceCode erlang"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a><span class="kw">-module</span><span class="fu">(</span><span class="ch">daytime</span><span class="fu">).</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a><span class="kw">-export</span><span class="fu">([</span><span class="ch">start</span><span class="op">/</span><span class="dv">0</span><span class="fu">]).</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a><span class="fu">start()</span> <span class="op">-&gt;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a>    <span class="fu">{</span><span class="ch">ok</span><span class="fu">,</span> <span class="va">Listen</span><span class="fu">}</span> <span class="op">=</span> <span class="fu">gen_tcp:listen(</span><span class="dv">1313</span><span class="fu">,</span> <span class="fu">[</span><span class="ch">binary</span><span class="fu">,</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a>                                        <span class="fu">{</span><span class="ch">packet</span><span class="fu">,</span> <span class="dv">0</span><span class="fu">},</span> <span class="fu">{</span><span class="ch">active</span><span class="fu">,</span> <span class="ch">false</span><span class="fu">},</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a>                                        <span class="fu">{</span><span class="ch">reuseaddr</span><span class="fu">,</span> <span class="ch">true</span><span class="fu">}]),</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a>    <span class="fu">spawn(</span><span class="kw">fun</span><span class="fu">()</span> <span class="op">-&gt;</span> <span class="fu">connect(</span><span class="va">Listen</span><span class="fu">)</span> <span class="kw">end</span><span class="fu">).</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true"></a><span class="fu">connect(</span><span class="va">Listen</span><span class="fu">)</span> <span class="op">-&gt;</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true"></a>    <span class="fu">{</span><span class="ch">ok</span><span class="fu">,</span> <span class="va">Socket</span><span class="fu">}</span> <span class="op">=</span> <span class="fu">gen_tcp:accept(</span><span class="va">Listen</span><span class="fu">),</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true"></a>    <span class="fu">spawn(</span><span class="kw">fun</span><span class="fu">()</span> <span class="op">-&gt;</span> <span class="fu">connect(</span><span class="va">Listen</span><span class="fu">)</span> <span class="kw">end</span><span class="fu">),</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true"></a>    <span class="fu">gen_tcp:send(</span><span class="va">Socket</span><span class="fu">,</span> <span class="fu">getDateTime()),</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true"></a>    <span class="fu">gen_tcp:close(</span><span class="va">Socket</span><span class="fu">).</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true"></a><span class="fu">getDateTime()</span> <span class="op">-&gt;</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true"></a>    <span class="fu">{</span><span class="va">YearMonthDay</span><span class="fu">,</span> <span class="fu">{</span><span class="va">Hour</span><span class="fu">,</span> <span class="va">Minute</span><span class="fu">,</span> <span class="va">Second</span><span class="fu">}}</span> <span class="op">=</span> <span class="fu">calendar:universal_time_to_local_time(erlang:universaltime()),</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true"></a>    <span class="va">DayOfWeek</span> <span class="op">=</span> <span class="fu">calendar:day_of_the_week(</span><span class="va">YearMonthDay</span><span class="fu">),</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true"></a>    <span class="va">DayName</span> <span class="op">=</span> <span class="fu">httpd_util:day(</span><span class="va">DayOfWeek</span><span class="fu">),</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true"></a>    <span class="va">MonthName</span> <span class="op">=</span> <span class="fu">httpd_util:month(</span><span class="va">Month</span><span class="fu">),</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true"></a>    <span class="va">DateString</span> <span class="op">=</span> <span class="fu">io_lib:format(</span><span class="st">&quot;~s, ~s ~p, ~p ~p:~p:~p~n&quot;</span><span class="fu">,</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true"></a>                                         <span class="fu">[</span><span class="va">DayName</span><span class="fu">,</span> <span class="va">MonthName</span><span class="fu">,</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true"></a>                                         <span class="va">Day</span><span class="fu">,</span> <span class="va">Year</span><span class="fu">,</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true"></a>                                         <span class="va">Hour</span><span class="fu">,</span> <span class="va">Minute</span><span class="fu">,</span> <span class="va">Second</span><span class="fu">]),</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true"></a>    <span class="fu">lists:flatten(</span><span class="va">DateString</span><span class="fu">).</span></span></code></pre></div>
<p>To test, startup an erlang shell:</p>
<pre><code>erl</code></pre>
<p>Compile the daytime.erl file:</p>
<pre><code>1&gt; c(daytime).
{ok,daytime}</code></pre>
<p>Startup the daytime server:</p>
<pre><code>2&gt; daytime:start().
&lt;0.50.0&gt;</code></pre>
<p>Now in another terminal fire up telnet and connect to port 1313.</p>
<pre><code>telnet localhost 1313</code></pre>
<p>You should get something like this:</p>
<pre><code>Trying ::1...
telnet: connect to address ::1: Connection refused
Trying fe80::1...
telnet: connect to address fe80::1: Connection refused
Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.
Sun, Oct 12, 2008 11:33:26
Connection closed by foreign host.</code></pre>

        </div>
        <div id="footer">
            Site proudly generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>
    </body>
</html>
