<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>My Hakyll Blog - Postfix & SMF</title>
        <link rel="stylesheet" type="text/css" href="../css/default.css" />
        <link rel="stylesheet" type="text/css" href="../css/screen.css" />
    </head>
    <body>
        <div id="header">
            <div id="logo">
                <a href="../">My Hakyll Blog</a>
            </div>
            <div id="navigation">
                <a href="../">Home</a>
                <a href="../about.html">About</a>
                <a href="../talks.html">Talks</a>
                <a href="../archive.html">Archive</a>
            </div>
        </div>

        <div id="content">
            <h1>Postfix & SMF</h1>

            <div class="info">
    Posted on December  8, 2007
    
        by Tim McGilchrist
    
</div>

<p>Blastwave’s Postfix doesn’t currently use SMF, but I really wanted it to. So I converted the SysV init script supplied into a more usable form. I’ll assume you’ve installed Postfix and have it configured the way you like. There are lots of tutorials around that can give you a start on how to do that, personally I’ve found the Gentoo documentation quite useful even on non-Linux systems.</p>
<p>Type the svcs command into a root shell like so:</p>
<pre><code>$ svcs |grep postfix
legacy_run     20:09:50 lrc:/etc/rc2_d/S50postfix</code></pre>
<p>this means that SMF is using the old style init scripts.</p>
<p>The first thing we need to do is write a series of targets to let SMF know how to stop, start and reload postfix. Luckily Blastwave comes with such a script, the init script under <strong>/etc/init</strong>. So what I did was copy that to the same place as the other Blastwave scripts live <strong>/opt/csw/lib/svc/method/</strong> and renamed it to <strong>svc-postfix</strong>, following the naming convention used for other services like Apache and MySQL.</p>
<p>Also check that the ownership permissions are the same as the other files in there, I had to <strong>chown root:bin svc-postfix</strong> the file so it matched the others.</p>
<p>Now we need a manifest, I used the existing manifest for Blastwave Apache as a guide to writing mine. Here is the <a href="http://gothmog.homeunix.net/downloads/smf-postfix/cswpostfix.xml">Manifest</a> which you need to copy this into <strong>/opt/csw/var/svc/manifest/site</strong>.</p>
<p>Now to import the manifest so SMF knows about it.</p>
<pre><code>$ /usr/sbin/svccfg -v import /opt/csw/var/svc/manifest/site/cswpostfix.xml</code></pre>
<p>The new service should now appear in the list of available services.</p>
<pre><code>$ svcs -a |grep postfix
online         Dec_06   svc:/network/smtp:cswpostfix&lt;</code></pre>
<p>Now to disable the old init script.</p>
<pre><code>$ cd /etc/rc2.d</code></pre>
<p>Stop the service</p>
<pre><code>$ ./S50postfix stop</code></pre>
<p>Move the symlink out of harms way, I usually don’t delete them incase I need them later, like if I disable a core service.</p>
<pre><code>$ mv S50postfix noS50postfix</code></pre>
<p>And ensure that it’s no longer executable, probably overkill but we really don’t want it running.</p>
<pre><code>$ chmod 000 noS50postfix</code></pre>
<p>Then we can enable the fancy new SMF service.</p>
<pre><code>$ svcadm enable cswpostfix</code></pre>
<p>Check that is started properly.</p>
<pre><code>$  svcs -x</code></pre>
<p>And that should be it, it’s usually a good idea to reboot when you’ve been messing with startup scripts. It ensures that you haven’t made any mistakes configuring things and the last thing you want is to find you messed up when something really does break.</p>
<h4 id="note">Note:</h4>
<p>This is my first go at converting a SysV init script into an SMF version so if there are any glaring mistakes, please drop me a line.</p>
<p>The inspiration for this post supplied by: <a href="http://prefetch.net/blog/index.php/2005/11/12/converting-an-rc-script-to-an-smf-manifest/">Converting an rcscript into an smf manifest</a></p>
<h4 id="downloads">Downloads</h4>
<p>Currently offline due to blog conversion to markdown, will post in github soon.</p>
<p><a href="http://gothmog.homeunix.net/downloads/smf-postfix/cswpostfix.xml">Manifest</a> <a href="http://gothmog.homeunix.net/downloads/smf-postfix/svc-postfix">Methods</a></p>

        </div>
        <div id="footer">
            Site proudly generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>
    </body>
</html>
